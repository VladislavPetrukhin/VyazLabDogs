<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Поиск собак</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon_dog.ico') }}">
</head>
<body>
    <h1>Поиск собак</h1>
   <nav>
        <a href="/">Главная</a> |
        <a href="/add_detailed">Добавить</a> |
        <a href="/stats">Статистика</a> |
        <a href="/search">Поиск</a>
    </nav>

    <form method="POST" id="searchForm">
        <label for="name">Имя собаки:</label>
        <select id="name" name="name">
            <option value="">-- Выберите имя --</option>
            {% for dog_name in dog_names %}
                <option value="{{ dog_name }}" {% if dog_name == name %}selected{% endif %}>{{ dog_name }}</option>
            {% endfor %}
        </select>
        <br>

        <label for="breed_name">Порода:</label>
        <select id="breed_name" name="breed_name" onchange="updateLocations()">
            <option value="">-- Выберите породу --</option>
            {% for breed in breeds %}
                <option value="{{ breed }}" {% if breed == breed_name %}selected{% endif %}>{{ breed }}</option>
            {% endfor %}
        </select>
        <br>

        <label for="location_name">Место размещения:</label>
        <select id="location_name" name="location_name" onchange="submitIfBothSelected()">
            <option value="">-- Выберите место --</option>
            {% if locations %}
                {% for location in locations %}
                    <option value="{{ location }}" {% if location == location_name %}selected{% endif %}>{{ location }}</option>
                {% endfor %}
            {% endif %}
        </select>
        <br>

        <button type="submit">Поиск</button>
    </form>

    {% if no_results %}
        <p>Ничего не найдено</p>
    {% endif %}

    {% if results %}
        <h2>Результаты поиска</h2>
        <table>
            <tr>
                <th>ID</th>
                <th>Имя</th>
                <th>Порода</th>
                <th>Место размещения</th>
                <th>Дата рождения</th>
                <th>Дата регистрации</th>
                <th>Номер микрочипа</th>
            </tr>
            {% for dog in results %}
                <tr>
                    <td>{{ dog.id }}</td>
                    <td>{{ dog.name }}</td>
                    <td>{{ dog.breed_name }}</td>
                    <td>{{ dog.location_name }}</td>
                    <td>{{ dog.birth_date }}</td>
                    <td>{{ dog.registration_date }}</td>
                    <td>{{ dog.microchip_number }}</td>
                </tr>
            {% endfor %}
        </table>
    {% endif %}

    <script>
        function updateLocations() {
            const breed = document.getElementById('breed_name').value;
            const locationSelect = document.getElementById('location_name');

            // Сброс списка мест
            locationSelect.innerHTML = '<option value="">-- Загрузка... --</option>';

            fetch(`/get_filtered_values?table0=breeds&first_attr=breed_name&first_value=${encodeURIComponent(breed)}&second_attr=location_name&table1=locations`)
                .then(response => response.json())
                .then(data => {
                    locationSelect.innerHTML = '<option value="">-- Выберите место --</option>';
                    data.forEach(loc => {
                        const option = document.createElement('option');
                        option.value = loc;
                        option.text = loc;
                        locationSelect.appendChild(option);
                    });
                });
        }

        function submitIfBothSelected() {
            const breed = document.getElementById('breed_name').value;
            const location = document.getElementById('location_name').value;
            if (breed && location) {
                document.getElementById('searchForm').submit();
            }
        }
    </script>
</body>
</html>

